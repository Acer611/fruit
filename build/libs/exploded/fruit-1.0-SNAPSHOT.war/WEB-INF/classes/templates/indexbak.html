<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1 ,user-scalable=no">
  <title>列表页面</title>
  <meta name="Keywords" content="">
  <meta name="Description" content="">
<script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js" type="text/javascript"></script> 
<link rel="stylesheet" href="css/mescroll.min.css">
<link rel="stylesheet" href="css/swiper-3.3.1.min.css">
<link rel="stylesheet" href="css/list.css">
 </head>
 <body>
 		<div class="header">
		
			<div class="scrollx mescroll-touch-x">
				<div id="scrollxContent" class="scrollx-content">
				
					<ul id="nav" class="nav">
						<li class="active" >推荐</li>
					</ul>
					
				</div>
			</div>
			
		</div>
 <div class="gap40"></div>
 		<!--轮播-->
		<div id="swiper" class="swiper-container">
		    <div id="swiperWrapper" class="swiper-wrapper">
		    	
	        	<!--首页-->
		        <div id="mescroll0" class="swiper-slide mescroll">
					<ul id="dataList0" class="data-list">
						<!--<li>
							<img class="pd-img" src="../res/img/pd1.jpg"/>
							<p class="pd-name">商品标题商品标题商品标题商品标题商品标题商品</p>
							<p class="pd-price">200.00 元</p>
							<p class="pd-sold">已售50件</p>
						</li>-->
					</ul>
		        </div>
		    	
		    </div>
		</div>
 
 
 

<script src="js/mescroll.min.js" type="text/javascript" charset="utf-8"></script>
<script src="js/swiper-3.3.1.min.js" type="text/javascript" charset="utf-8"></script>
<!-- <script type="text/javascript">
function getData(id){
	$.ajax({
	    type: 'GET',
	    url: 'http://localhost:8080/TestWebProject/selectAritleByChannelIddesc',
	    data:{ channelGuid:id },
	    dataType: 'json',
	    success: function(result){
	    	var data=result.data;
		console.log(data);
	    	var listData=[];
	    //	var data=result.cards;
			console.log(data);
	    		//首页 (模拟分页数据)
			for (var i = (pageNum-1)*pageSize; i < pageNum*pageSize; i++) {
        		if(i==data.length) break;
        		listData.push(data[i]);
        	}
	    	//回调
	    	successCallback(listData);
	    }
	});
}
</script> -->
 
  <script type="text/javascript">
  function getData(id){
		$.ajax({
		    type: 'GET',
		    url: 'http://localhost:8080/TestWebProject/selectAritleByChannelIddesc',
		    data:{ channelGuid:id },
		    dataType: 'json',
		    success: function(result){
		    	var data=result.data;
			console.log(data);
		    	var listData=[];
		    //	var data=result.cards;
				console.log(data);
		    		//首页 (模拟分页数据)
				for (var i = (pageNum-1)*pageSize; i < pageNum*pageSize; i++) {
	        		if(i==data.length) break;
	        		listData.push(data[i]);
	        	}
		    	//回调
		    	successCallback(listData);
		    }
		});
}
$(function() {  
    var pic3liw=$(".pic3 .pic li").width();
	$(".pic3 .pic li").css("height",pic3liw*3/4);

//获取频道	
	$.ajax({
	    type: 'GET',
	    url: 'http://localhost:8080/TestWebProject/selectChannelByUserId',
	    dataType: 'json',
	    success: function(result){
	    	var data=result.data;
			for (var i in data) {
				//var strtap='<li><input type="button" onclick="getData(\''+data[i].channelGuid+'\')" value='+data[i].channelName+'></li>';
				var strtap='<li><a onclick="getData(\''+data[i].channelGuid+'\')" >'+data[i].channelName+'</a></li>';
				$(".nav").append(strtap);
			}
	    }
	
	});

//获取内容
	function getListDataFromNet(pageNum,pageSize,successCallback,errorCallback) {
		//延时一秒,模拟联网
              setTimeout(function () {
              	$.ajax({
                type: 'GET',
                 url: 'http://localhost:8080/TestWebProject/selectAritleByChannelIddesc',
            //    url: 'list.json?curNavIndex='+curNavIndex+'&num='+pageNum+'&size='+pageSize,
                dataType: 'json',
                success: function(result){
                	var data=result.data;
				console.log(data);
                	var listData=[];
                //	var data=result.cards;
					console.log(data);
            
                		//首页 (模拟分页数据)
						for (var i = (pageNum-1)*pageSize; i < pageNum*pageSize; i++) {
		            		if(i==data.length) break;
		            		listData.push(data[i]);
		            	}		
                	
                	}
                	
                	//回调
                	//successCallback(listData);
               // error: errorCallback
            });
              },500)
	}




	/*切换列表*/
	function changePage(i) {
		if(curNavIndex!=i) {
			//更改列表条件
			var curNavDom;//当前菜单项
			$("#nav li").each(function(n,dom){
				if (dom.getAttribute("i")==i) {
					dom.classList.add("active");
					curNavDom=dom;
				} else{
					dom.classList.remove("active");
				}
			});
			//菜单项居中动画
			var scrollxContent=document.getElementById("scrollxContent");
			var star = scrollxContent.scrollLeft;//当前位置
			var end = curNavDom.offsetLeft + curNavDom.clientWidth/2 - document.body.clientWidth/2; //居中
			mescrollArr[curNavIndex].getStep(star, end, function(step,timer){
				scrollxContent.scrollLeft=step; //从当前位置逐渐移动到中间位置,默认时长300ms
			});
			//隐藏当前回到顶部按钮
			mescrollArr[curNavIndex].hideTopBtn();
			//取出菜单所对应的mescroll对象,如果未初始化则初始化
			if(mescrollArr[i]==null){
				mescrollArr[i]=initMescroll(i);
			}else{
				//检查是否需要显示回到到顶按钮
				var curMescroll=mescrollArr[i];
				var curScrollTop=curMescroll.getScrollTop();
				if(curScrollTop>=curMescroll.optUp.toTop.offset){
					curMescroll.showTopBtn();
				}else{
					curMescroll.hideTopBtn();
				}
			}
			//更新标记
			curNavIndex=i;
		}
	}
			
			
	/*创建MeScroll对象*/
	function initMescroll(index){
		//创建MeScroll对象,内部已默认开启下拉刷新,自动执行up.callback,刷新列表数据;
		var mescroll = new MeScroll("mescroll"+index, {
			//上拉加载的配置项
			up: {
				callback: getListData, //上拉回调,此处可简写; 相当于 callback: function (page) { getListData(page); }
				isBounce: false, //此处禁止ios回弹,解析(务必认真阅读,特别是最后一点): http://www.mescroll.com/qa.html#q10
				noMoreSize: 4, //如果列表已无数据,可设置列表的总数量要大于半页才显示无更多数据;避免列表数据过少(比如只有一条数据),显示无更多数据会不好看; 默认5
				empty: {
					icon: "../res/img/mescroll-empty.png", //图标,默认null
					tip: "暂无相关数据~", //提示
					btntext: "去逛逛 >", //按钮,默认""
					btnClick: function(){//点击按钮的回调,默认null
						alert("点击了按钮,具体逻辑自行实现");
					} 
				},
				clearEmptyId: "dataList"+index,
				toTop:{ //配置回到顶部按钮
					src : "../res/img/mescroll-totop.png", //默认滚动到1000px显示,可配置offset修改
					//offset : 1000
				},
				isBounce:false
			}
		});
		return mescroll;
	}
	
	/*联网加载列表数据  page = {num:1, size:10}; num:当前页 从1开始, size:每页数据条数 */
	function getListData(page){
		//联网加载数据
		var dataIndex=curNavIndex; //记录当前联网的nav下标,防止快速切换时,联网回来curNavIndex已经改变的情况;
		getListDataFromNet(dataIndex, page.num, page.size, function(pageData){
			//联网成功的回调,隐藏下拉刷新和上拉加载的状态;
			//mescroll会根据传的参数,自动判断列表如果无任何数据,则提示空;列表无下一页数据,则提示无更多数据;
			console.log("dataIndex="+dataIndex+", curNavIndex="+curNavIndex+", page.num="+page.num+", page.size="+page.size+", pageData.length="+pageData.length);
			
			//方法一(推荐): 后台接口有返回列表的总页数 totalPage
			//mescrollArr[dataIndex].endByPage(pageData.length, totalPage); //必传参数(当前页的数据个数, 总页数)
			
			//方法二(推荐): 后台接口有返回列表的总数据量 totalSize
			//mescrollArr[dataIndex].endBySize(pageData.length, totalSize); //必传参数(当前页的数据个数, 总数据量)
			
			//方法三(推荐): 您有其他方式知道是否有下一页 hasNext
			//mescrollArr[dataIndex].endSuccess(pageData.length, hasNext); //必传参数(当前页的数据个数, 是否有下一页true/false)
			
			//方法四 (不推荐),会存在一个小问题:比如列表共有20条数据,每页加载10条,共2页.如果只根据当前页的数据个数判断,则需翻到第三页才会知道无更多数据,如果传了hasNext,则翻到第二页即可显示无更多数据.
			mescrollArr[dataIndex].endSuccess(pageData.length);
			
			//设置列表数据
			setListData(pageData,dataIndex);
		}, function(){
			//联网失败的回调,隐藏下拉刷新和上拉加载的状态;
               mescrollArr[dataIndex].endErr();
		});
	}
	
	/*设置列表数据
	 * pageData 当前页的数据
	 * dataIndex 数据属于哪个nav */
	 
	function setListData(pageData,dataIndex){
		var listDom=document.getElementById("dataList"+dataIndex);
		for (var i = 0; i < pageData.length; i++) {
			var pd=pageData[i];
			
			var str='<img class="pd-img" src="'+pd.pdImg+'"/>';
			str+='<p class="pd-name">'+pd.pdName+'</p>';
			str+='<p class="pd-price">'+pd.pdPrice+' 元</p>';
			str+='<p class="pd-sold">已售'+pd.pdSold+'件</p>';
			
			var liDom=document.createElement("li");
			liDom.innerHTML=str;
			listDom.appendChild(liDom);
		}
	}
	 
	 
	<!-- function setListData(pageData,dataIndex){ -->
		<!-- var listDom=document.getElementById("dataList"+dataIndex); -->
		<!-- for (var i = 0; i < pageData.length; i++) { -->
			<!-- var pd=pageData[i]; -->
			
			<!-- if(pd.type=1){ -->
			
			<!-- var str='<div class="box"><div class="pic1"><div class="pic">'; -->
			<!-- str+='<img src="'+pd.img+'"/></div>'; -->
			<!-- str+='<div class="tit"><div class="tit1">'; -->
			<!-- str+='<div class="tit2">'+pd.title+'</div></div></div>'; -->
			<!-- str+='<div class="source">'+pd.source+'</div></div></div>'; -->
			<!-- var liDom=document.createElement("li"); -->
			<!-- liDom.innerHTML=str; -->
			<!-- listDom.appendChild(liDom); -->
		    <!-- } -->
		<!-- } -->
	<!-- } -->
	
	/*联网加载列表数据
	 在您的实际项目中,请参考官方写法: http://www.mescroll.com/api.html#tagUpCallback
	 请忽略getListDataFromNet的逻辑,这里仅仅是在本地模拟分页数据,本地演示用
	 实际项目以您服务器接口返回的数据为准,无需本地处理分页.
	 * */

			
});
	</script>
			
		
 </body>
</html>